
@using DoAnAdmin.Models
@model List<DetailsOrder>
@{
    ViewBag.Title = "Đơn hàng";
    Layout = "~/Views/Shared/_DetailLayoutPage.cshtml";
    QL_LaptopEntities mydb = new QL_LaptopEntities();
    string sdt = "";
    int i = 0;
    if (Model.Count != 0)
    {
        sdt = Model.FirstOrDefault().Customer.cusPhone.Trim().ToString();
    }
    else
    {
        i = 1;
    }
    var lstDHXN = mydb.Orders.Where(n => n.Customer.cusPhone.Equals(sdt) && n.orderStatus.Equals("Đang chờ xác nhận"));
    int ttDHXN = 0;
    var lstDHDG = mydb.Orders.Where(n => n.Customer.cusPhone.Equals(sdt) && n.orderStatus.Equals("Đang giao hàng"));
    int ttDHDG = 0;
    int ttDHHT = 0;
    int ttDHDH = 0;
    var lstDGH = mydb.Orders.Where(n => n.Customer.cusPhone.Equals(sdt) && n.orderStatus.Equals("Đã giao hàng"));
    var lstHT = mydb.Orders.Where(n => n.Customer.cusPhone.Equals(sdt) && n.orderStatus.Equals("Giao hàng thành công"));
    var lstDHDH = mydb.Orders.Where(n => n.Customer.cusPhone.Equals(sdt) && n.orderStatus.Equals("Đã hủy"));
    var lstTraLai = mydb.Orders.Where(n => n.Customer.cusPhone.Equals(sdt) && n.orderStatus.Equals("Trả hàng"));
}
<style>
    .searchPhone_title {
        margin-right: 22px;
        text-align: center;
    }

        .searchPhone_title a {
            color: black;
            padding: 14px 32px;
            line-height: 50px;
            font-size: 16px;
        }

            .searchPhone_title a:focus {
                border-bottom: 2px solid #FF7B54;
                color: #FF7B54;
            }

    .searchPhone_name {
        margin-top: 30px;
        font-size: 22px !important;
        text-align: center;
        color: #FF7B54;
    }

    .AdOrcer_btn {
        background-color: #FF7B54;
        border-radius: 10px !important;
    }

        .AdOrcer_btn:hover {
            background-color: #EEF1FF;
            border: 2px solid black;
        }
</style>

<div style="margin-left:30px">
    <p>Tìm kiếm đơn hàng :</p>
    @using (Html.BeginForm("SearchPhone", "Payment"))
    {
        <input id="txt_sdt"
               name="txt_sdt"
               type="text"
               class="search-box-input orderPhone_input"
               placeholder="Nhập số điện thoại" />
        <button class="button-35" type="submit">Tìm kiếm</button>
    }
</div>
<div class="container" style="margin: 15px 50px;">
    <ul class="nav nav-tabs" style="height: 50px; box-shadow: 6px 9px 18px 6px #f5f5f5;">
        <li class="active searchPhone_title"><a aria-controls="dangXN" role="tab" data-toggle="tab" href="#dangXN">Đang chờ xác nhận</a></li>
        <li class="searchPhone_title"><a aria-controls="dangGH" role="tab" data-toggle="tab" href="#dangGH">Đang giao hàng</a></li>
        <li class="searchPhone_title"><a aria-controls="daGH" role="tab" data-toggle="tab" href="#daGH">Đã giao hàng</a></li>
        <li class="searchPhone_title"><a aria-controls="giaoTC" role="tab" data-toggle="tab" href="#giaoTC">Giao hàng thành công</a></li>
        <li class="searchPhone_title"><a aria-controls="donHuy" role="tab" data-toggle="tab" href="#donHuy">Đã hủy</a></li>
        <li class="searchPhone_title"><a aria-controls="donTra" role="tab" data-toggle="tab" href="#donTra">Trả lại</a></li>
    </ul>
    <div class="tab-content" style="margin-bottom:108px">
        <div id="dangXN" class="tab-pane in active">
            <p class="searchPhone_name">Đơn hàng đang xác nhận</p>
            @if (lstDHXN.Count() == 0)
            {
                <div class="h-100" id="wrapper" style="background-color: white; padding: 50px 0;">
                    <center class="mt-3">
                        <img style="width:13%" src="https://cdn-icons-png.flaticon.com/512/1376/1376786.png" />
                        <br />
                        <br />
                        <p>Không có đơn hàng</p>
                        <a class="btn btn-outline-primary mb-1 mt-2" href="@Url.Action("ShowAllProducts","Product")" style="font-weight:bold"> VỀ TRANG CHỦ </a>
                        <p>Khi cần trợ giúp vui lòng liên hệ <a href="tel:0397495029" style="text-decoration-color:#1899ba">&nbsp;0339.906.489</a>&nbsp;(7h30 - 22h)</p>
                    </center>
                </div>
            }
            else
            {
                <div>
                    @foreach (var or in lstDHXN)
                    {
                        var det = mydb.DetailsOrders.Where(n => n.orderID == or.orderID).FirstOrDefault();
                        int tt = (int)det.orderQuantity * (int)det.proPrice;
                        ttDHXN = ttDHXN + (int)det.orderQuantity * (int)det.proPrice;
                        var lstDetOrder = mydb.DetailsOrders.Where(n => n.orderID == or.orderID);
                        <div class="SP_order">
                            <div class="d-flex SP_order_header row">
                                <div class="d-flex SP_order_header_ma col-2">
                                    <h5 style="margin-right:7px">Mã đơn hàng:</h5>
                                    <h5>@or.orderID</h5>
                                </div>
                                <div class="col-4" style=" margin: 7px;">Ngày mua: @or.orderDate</div>
                                <div class="col-5" style="text-align: end;">
                                    <a class="btn searchPhone_btnHuy" data-abc="true"
                                       data-bs-toggle="modal" data-bs-target="#exampleModal">
                                        <img style="width:20px;height:20px" src="https://cdn-icons-png.flaticon.com/512/1721/1721578.png" />
                                    </a>

                                    <!-- Modal -->
                                    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                        <div class="modal-dialog">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h1 class="modal-title fs-5" id="exampleModalLabel">Nhập lý do hủy</h1>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                </div>
                                                @using (Html.BeginForm("DeletePay", "Payment", new { idOr = or.orderID, strURL = Request.Url.ToString() }))
                                                {
                                                    <div class="modal-body">

                                                        <input id="txtLiDo"
                                                               name="txtLiDo"
                                                               type="text"
                                                               class="search-box-input input_huy"
                                                               placeholder="Lý do hủy đơn hàng ?" />
                                                        @*<button class="btn btn-dark searchPhone_btnHuy">Gửi</button>*@

                                                    </div>
                                                    <div class="modal-footer">

                                                        <button class="btn btn-dark searchPhone_btnHuy">Gửi</button>
                                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                    </div>
                                                }
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                @foreach (var item in lstDetOrder)
                                {
                                    mydb = new QL_LaptopEntities();
                                    var cus = mydb.Customers.Where(n => n.cusID == item.cusID).FirstOrDefault();
                                    var cusAdr = mydb.CustomerAddresses.Where(n => n.cusID == cus.cusID).FirstOrDefault();
                                    var pro = mydb.Products.Where(n => n.id == item.proID).FirstOrDefault();
                                    var orr = mydb.Orders.Where(n => n.cusID == cus.cusID).FirstOrDefault();

                                    using (Html.BeginForm("Update", "Cart"))
                                    {
                                        <div class="row SP_order_main">
                                            <div class="col-2">
                                                <img src="~/Assets/Image/ImageProduct/@pro.avatar" alt="" class="img-fluid d-none d-md-block rounded mb-2 shadow ">
                                            </div>
                                            <div class="col-8">
                                                <p class="SP_order_name">@pro.Name</p>
                                                <p class="SP_order_quantity">Số lượng: @item.orderQuantity</p>
                                            </div>
                                            <div class="col-2">
                                                <p class="SP_order_price">@String.Format("{0:0,0}", @pro.price) VND</p>
                                            </div>
                                        </div>

                                    }
                                }

                            </div>
                            <div class="SP_order_totalMoney">
                                <img style="width:25px;height:25px" src="https://cdn-icons-png.flaticon.com/512/543/543135.png" />
                                <p style="padding:0 10px">Thành tiền: </p>
                                <p style=" font-size: 22px; padding: 0 10px; color: #ee4d2d;">@String.Format("{0:0,0}", @tt) VND</p>

                            </div>
                        </div>

                    }
                </div>
                <div class="row mt-5 d-flex align-items-center" style="margin-left:20px">

                    <div class="col-sm-7 mb-3 mb-m-1 order-md-1 text-md-left">
                        <a href="@Url.Action("ShowAllProducts","Product")">
                            <i class="fas fa-arrow-left mr-2"></i> Tiếp tục mua sắm
                        </a>
                    </div>
                </div>
            }

        </div>
        <div id="dangGH" class="tab-pane fade">
            <p class="searchPhone_name">Đơn hàng đang giao hàng</p>
            @if (lstDHDG.Count() == 0)
            {
                <div class="h-100" id="wrapper" style="background-color: white; padding: 50px 0;">
                    <center class="mt-3">
                        <img style="width:13%" src="https://cdn-icons-png.flaticon.com/512/1376/1376786.png" />
                        <br />
                        <br />
                        <p>Không có đơn hàng nào!</p>
                        <a class="btn btn-outline-primary mb-1 mt-2" href="@Url.Action("ShowAllProducts","Product")" style="font-weight:bold"> VỀ TRANG CHỦ </a>
                        <p>Khi cần trợ giúp vui lòng liên hệ <a href="tel:0397495029" style="text-decoration-color:#1899ba">&nbsp;0339.906.489</a>&nbsp;(7h30 - 22h)</p>
                    </center>
                </div>
            }
            else
            {
                <div class="">
                    @foreach (var or in lstDHDG)
                    {
                        var det = mydb.DetailsOrders.Where(n => n.orderID == or.orderID).FirstOrDefault();
                        int tt = (int)det.orderQuantity * (int)det.proPrice;
                        ttDHDG = ttDHDG + (int)det.orderQuantity * (int)det.proPrice;
                        var lstDetOrder = mydb.DetailsOrders.Where(n => n.orderID == or.orderID);

                        <div class="SP_order">
                            <div class="d-flex SP_order_header">
                                <div class="d-flex SP_order_header_ma">
                                    <h5 style="margin-right:7px">Mã đơn hàng:</h5>
                                    <h5>@or.orderID</h5>
                                </div>
                                <div style=" margin: 7px;">Ngày mua: @or.orderDate</div>
                            </div>
                            <div>
                                @foreach (var item in lstDetOrder)
                                {
                                    mydb = new QL_LaptopEntities();
                                    var cus = mydb.Customers.Where(n => n.cusID == item.cusID).FirstOrDefault();
                                    var cusAdr = mydb.CustomerAddresses.Where(n => n.cusID == cus.cusID).FirstOrDefault();
                                    var pro = mydb.Products.Where(n => n.id == item.proID).FirstOrDefault();
                                    var orr = mydb.Orders.Where(n => n.cusID == cus.cusID).FirstOrDefault();

                                    using (Html.BeginForm("Update", "Cart"))
                                    {
                                        <div class="row SP_order_main">
                                            <div class="col-2">
                                                <img src="~/Assets/Image/ImageProduct/@pro.avatar" alt="" class="img-fluid d-none d-md-block rounded mb-2 shadow ">
                                            </div>
                                            <div class="col-8">
                                                <p class="SP_order_name">@pro.Name</p>
                                                <p class="SP_order_quantity">Số lượng: @item.orderQuantity</p>
                                            </div>
                                            <div class="col-2">
                                                <p class="SP_order_price">@String.Format("{0:0,0}", @pro.price) VND</p>
                                            </div>
                                        </div>

                                    }
                                }

                            </div>
                            <div class="SP_order_totalMoney">
                                <img style="width:25px;height:25px" src="https://cdn-icons-png.flaticon.com/512/543/543135.png" />
                                <p style="padding:0 10px">Thành tiền: </p>
                                <p style=" font-size: 22px; padding: 0 10px; color: #ee4d2d;">@String.Format("{0:0,0}", @tt) VND</p>

                            </div>
                        </div>

                    }
                </div>
                <div class="row mt-4 d-flex align-items-center" style="margin-left:20px;margin-bottom:20px">

                    <div class="col-sm-6 mb-3 mb-m-1 order-md-1 text-md-left">
                        <a href="@Url.Action("ShowAllProducts","Product")">
                            <i class="fas fa-arrow-left mr-2"></i> Tiếp tục mua sắm
                        </a>
                    </div>
                </div>
            }

        </div>
        <div id="daGH" class="tab-pane fade">
            <p class="searchPhone_name">Đơn hàng đã giao hàng</p>
            @if (lstDGH.Count() == 0)
            {
                <div class="h-100" id="wrapper" style="background-color: white; padding: 50px 0;">
                    <center class="mt-3">
                        <img style="width:13%" src="https://cdn-icons-png.flaticon.com/512/1376/1376786.png" />
                        <br />
                        <br />
                        <p>Không có đơn hàng nào!</p>
                        <a class="btn btn-outline-primary mb-1 mt-2" href="@Url.Action("ShowAllProducts","Product")" style="font-weight:bold"> VỀ TRANG CHỦ </a>
                        <p>Khi cần trợ giúp vui lòng liên hệ <a href="tel:0397495029" style="text-decoration-color:#1899ba">&nbsp;0397.495.029</a>&nbsp;(7h30 - 22h)</p>
                    </center>

                </div>
            }
            else
            {
                <div class="">
                    @foreach (var or in lstDGH)
                    {
                        var det = mydb.DetailsOrders.Where(n => n.orderID == or.orderID).FirstOrDefault();
                        int tt = (int)det.orderQuantity * (int)det.proPrice;
                        ttDHDG = ttDHDG + (int)det.orderQuantity * (int)det.proPrice;
                        var lstDetOrder = mydb.DetailsOrders.Where(n => n.orderID == or.orderID);
                        <div class="SP_order">
                            <div class="d-flex SP_order_header row">
                                <div class="d-flex SP_order_header_ma col-2">
                                    <h5 style="margin-right:7px">Mã đơn hàng:</h5>
                                    <h5>@or.orderID</h5>
                                </div>
                                <div class="col-4" style=" margin: 7px;">Ngày mua: @or.orderDate</div>
                                <div class="col-5" style="text-align: end;">
                                    <a class="btn AdOrcer_btn" href="@Url.Action("completeOrder", "Payment", new { idOr = or.orderID, strURL = Request.Url.ToString() })" style="text-decoration:none;color:black">Hoàn thành</a>
                                    <a class="btn AdOrcer_btn searchPhone_btnHuy" data-abc="true"
                                       data-bs-toggle="modal" data-bs-target="#exampleModal1">
                                        <label>Trả hàng</label>
                                        @*<img style="width:20px;height:20px" src="https://cdn-icons-png.flaticon.com/512/1721/1721578.png" />*@
                                    </a>

                                    <!-- Modal -->
                                    <div class="modal fade" id="exampleModal1" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                        <div class="modal-dialog">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h1 class="modal-title fs-5" id="exampleModalLabel">Nhập lý do trả hoặc đổi</h1>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                </div>
                                                @using (Html.BeginForm("returnProduct", "Payment", new { idOr = or.orderID, strURL = Request.Url.ToString() }))
                                                {
                                                    <div class="modal-body">

                                                        <input id="txtLiDoTraHang"
                                                               name="txtLiDoTraHang"
                                                               type="text"
                                                               class="search-box-input input_huy"
                                                               placeholder="Lý do hủy đơn hàng ?" />
                                                        @*<button class="btn btn-dark searchPhone_btnHuy">Gửi</button>*@
                                                        <input type="file" id="file-uploader" class="input_huy mt-3" name="txtNameImage" onchange="chooseFile(this)">
                                                        <img src="" alt="" id="image" width="100%" height="250" class="mt-3 an" />
                                                        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
                                                        <script>
                                                            const fileUploader = document.getElementById('file-uploader');
                                                            const img = document.getElementById('image');
                                                            //fileUploader.addEventListener('change', (event) => {
                                                            //    const files = event.target.files;
                                                            //    console.log('files', files);
                                                            //});
                                                            function chooseFile(FileInput) {
                                                                img.classList.remove('an');
                                                                if (FileInput.files && FileInput.files[0]) {
                                                                    var reader = new FileReader();
                                                                    reader.onload = function (e) {
                                                                        $(`#image`).attr('src', e.target.result);
                                                                    }
                                                                    reader.readAsDataURL(FileInput.files[0])
                                                                }
                                                            }
                                                        </script>
                                                    </div>
                                                    <div class="modal-footer">

                                                        <button class="btn btn-dark searchPhone_btnHuy">Gửi</button>
                                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                    </div>
                                                }
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                @foreach (var item in lstDetOrder)
                                {
                                    mydb = new QL_LaptopEntities();
                                    var cus = mydb.Customers.Where(n => n.cusID == item.cusID).FirstOrDefault();
                                    var cusAdr = mydb.CustomerAddresses.Where(n => n.cusID == cus.cusID).FirstOrDefault();
                                    var pro = mydb.Products.Where(n => n.id == item.proID).FirstOrDefault();
                                    var orr = mydb.Orders.Where(n => n.cusID == cus.cusID).FirstOrDefault();

                                    using (Html.BeginForm("Update", "Cart"))
                                    {
                                        <div class="row SP_order_main">
                                            <div class="col-2">
                                                <img src="~/Assets/Image/ImageProduct/@pro.avatar" alt="" class="img-fluid d-none d-md-block rounded mb-2 shadow ">
                                            </div>
                                            <div class="col-8">
                                                <p class="SP_order_name">@pro.Name</p>
                                                <p class="SP_order_quantity">Số lượng: @item.orderQuantity</p>
                                            </div>
                                            <div class="col-2">
                                                <p class="SP_order_price">@String.Format("{0:0,0}", @pro.price) VND</p>
                                            </div>
                                        </div>

                                    }
                                }

                            </div>
                            <div class="SP_order_totalMoney">
                                <img style="width:25px;height:25px" src="https://cdn-icons-png.flaticon.com/512/543/543135.png" />
                                <p style="padding:0 10px">Thành tiền: </p>
                                <p style=" font-size: 22px; padding: 0 10px; color: #ee4d2d;">@String.Format("{0:0,0}", @tt) VND</p>

                            </div>
                        </div>

                    }
                </div>
                <div class="row mt-4 d-flex align-items-center" style="margin-left:20px;margin-bottom:20px">

                    <div class="col-sm-6 mb-3 mb-m-1 order-md-1 text-md-left">
                        <a href="@Url.Action("ShowAllProducts","Product")">
                            <i class="fas fa-arrow-left mr-2"></i> Tiếp tục mua sắm
                        </a>
                    </div>
                </div>
            }


        </div>
        <div id="giaoTC" class="tab-pane fade">
            <p class="searchPhone_name">Đơn hàng giao thành công</p>
            @if (lstHT.Count() == 0)
            {
                <div class="h-100" id="wrapper" style="background-color: white; padding: 50px 0;">
                    <center class="mt-3">
                        <img style="width:13%" src="https://cdn-icons-png.flaticon.com/512/1376/1376786.png" />
                        <br />
                        <br />
                        <p>Không có đơn hàng nào!</p>
                        <a class="btn btn-outline-primary mb-1 mt-2" href="@Url.Action("ShowAllProducts","Product")" style="font-weight:bold"> VỀ TRANG CHỦ </a>
                        <p>Khi cần trợ giúp vui lòng liên hệ <a href="tel:0397495029" style="text-decoration-color:#1899ba">&nbsp;0397.495.029</a>&nbsp;(7h30 - 22h)</p>
                    </center>

                </div>
            }
            else
            {
                <div class="">
                    @foreach (var or in lstHT)
                    {
                        var det = mydb.DetailsOrders.Where(n => n.orderID == or.orderID).FirstOrDefault();
                        int tt = (int)det.orderQuantity * (int)det.proPrice;
                        var lstDetOrder = mydb.DetailsOrders.Where(n => n.orderID == or.orderID);
                        <div class="SP_order">
                            <div class="d-flex SP_order_header">
                                <div class="d-flex SP_order_header_ma">
                                    <h5 style="margin-right:7px">Mã đơn hàng:</h5>
                                    <h5>@or.orderID</h5>
                                </div>
                                <div style=" margin: 7px;">Ngày mua: @or.orderDate</div>
                            </div>
                            <div>
                                @foreach (var item in lstDetOrder)
                                {
                                    mydb = new QL_LaptopEntities();
                                    var cus = mydb.Customers.Where(n => n.cusID == item.cusID).FirstOrDefault();
                                    var cusAdr = mydb.CustomerAddresses.Where(n => n.cusID == cus.cusID).FirstOrDefault();
                                    var pro = mydb.Products.Where(n => n.id == item.proID).FirstOrDefault();
                                    var orr = mydb.Orders.Where(n => n.cusID == cus.cusID).FirstOrDefault();

                                    using (Html.BeginForm("Update", "Cart"))
                                    {
                                        <div class="row SP_order_main">
                                            <div class="col-2">
                                                <img src="~/Assets/Image/ImageProduct/@pro.avatar" alt="" class="img-fluid d-none d-md-block rounded mb-2 shadow ">
                                            </div>
                                            <div class="col-8">
                                                <p class="SP_order_name">@pro.Name</p>
                                                <p class="SP_order_quantity">Số lượng: @item.orderQuantity</p>
                                            </div>
                                            <div class="col-2">
                                                <p class="SP_order_price">@String.Format("{0:0,0}", @pro.price) VND</p>
                                            </div>
                                        </div>

                                    }
                                }

                            </div>
                            <div class="SP_order_totalMoney">
                                <img style="width:25px;height:25px" src="https://cdn-icons-png.flaticon.com/512/543/543135.png" />
                                <p style="padding:0 10px">Thành tiền: </p>
                                <p style=" font-size: 22px; padding: 0 10px; color: #ee4d2d;">@String.Format("{0:0,0}", @tt) VND</p>

                            </div>
                        </div>

                    }
                </div>
                <div class="row mt-4 d-flex align-items-center" style="margin-left:20px;margin-bottom:20px">

                    <div class="col-sm-6 mb-3 mb-m-1 order-md-1 text-md-left">
                        <a href="@Url.Action("ShowAllProducts","Product")">
                            <i class="fas fa-arrow-left mr-2"></i> Tiếp tục mua sắm
                        </a>
                    </div>
                </div>
            }

        </div>
        <div id="donHuy" class="tab-pane fade">
            <p class="searchPhone_name">Đơn hàng đã hủy</p>
            @if (lstDHDH.Count() == 0)
            {
                <div class="h-100" id="wrapper" style="background-color: white; padding: 50px 0;">
                    <center class="mt-3">
                        <img style="width:13%" src="https://cdn-icons-png.flaticon.com/512/1376/1376786.png" />
                        <br />
                        <br />
                        <p>Không có đơn hàng nào!</p>
                        <a class="btn btn-outline-primary mb-1 mt-2" href="@Url.Action("ShowAllProducts","Product")" style="font-weight:bold"> VỀ TRANG CHỦ </a>
                        <p>Khi cần trợ giúp vui lòng liên hệ <a href="tel:0397495029" style="text-decoration-color:#1899ba">&nbsp;0397.495.029</a>&nbsp;(7h30 - 22h)</p>
                    </center>

                </div>
            }
            else
            {
                <div class="">
                    @foreach (var or in lstDHDH)
                    {

                        var det = mydb.DetailsOrders.Where(n => n.orderID == or.orderID).FirstOrDefault();
                        int tt = (int)det.orderQuantity * (int)det.proPrice;
                        ttDHDH = ttDHDH + (int)det.orderQuantity * (int)det.proPrice;
                        var lstDetOrder = mydb.DetailsOrders.Where(n => n.orderID == or.orderID);
                        var orcan = mydb.CancelOrders.Where(n => n.id_order == or.orderID).FirstOrDefault();
                        <div class="SP_order">
                            <div class="d-flex SP_order_header">
                                <div class="d-flex SP_order_header_ma">
                                    <h5 style="margin-right:7px">Mã đơn hàng:</h5>
                                    <h5>@or.orderID</h5>
                                </div>
                                <div style=" margin: 7px;">Ngày mua: @or.orderDate</div>
                            </div>
                            <div>
                                @foreach (var item in lstDetOrder)
                                {
                                    mydb = new QL_LaptopEntities();

                                    var cus = mydb.Customers.Where(n => n.cusID == item.cusID).FirstOrDefault();
                                    var cusAdr = mydb.CustomerAddresses.Where(n => n.cusID == cus.cusID).FirstOrDefault();
                                    var pro = mydb.Products.Where(n => n.id == item.proID).FirstOrDefault();
                                    var orr = mydb.Orders.Where(n => n.cusID == cus.cusID).FirstOrDefault();

                                    using (Html.BeginForm("Update", "Cart"))
                                    {
                                        <div class="row SP_order_main">
                                            <div class="col-2">
                                                <img src="~/Assets/Image/ImageProduct/@pro.avatar" alt="" class="img-fluid d-none d-md-block rounded mb-2 shadow ">
                                            </div>
                                            <div class="col-8">
                                                <p class="SP_order_name">@pro.Name</p>
                                                <p class="SP_order_quantity">Số lượng: @item.orderQuantity</p>
                                            </div>
                                            <div class="col-2">
                                                <p class="SP_order_price">@String.Format("{0:0,0}", @pro.price) VND</p>
                                            </div>
                                        </div>

                                    }
                                }

                            </div>
                            <div class="d-flex reason">
                                <p style="font-weight: 600; margin-right: 10px">Lý do hủy:</p>
                                <p>@orcan.reason</p>
                            </div>
                            <div class="SP_order_totalMoney">
                                <img style="width:25px;height:25px" src="https://cdn-icons-png.flaticon.com/512/543/543135.png" />
                                <p style="padding:0 10px">Thành tiền: </p>
                                <p style=" font-size: 22px; padding: 0 10px; color: #ee4d2d;">@String.Format("{0:0,0}", @tt) VND</p>

                            </div>
                        </div>

                    }
                </div>
                <div class="row mt-4 d-flex align-items-center" style="margin-left:20px;margin-bottom:20px">

                    <div class="col-sm-6 mb-3 mb-m-1 order-md-1 text-md-left">
                        <a href="@Url.Action("ShowAllProducts","Product")">
                            <i class="fas fa-arrow-left mr-2"></i> Tiếp tục mua sắm
                        </a>
                    </div>
                </div>
            }


        </div>
        <div id="donTra" class="tab-pane fade">
            <p class="searchPhone_name">Đơn hàng trả lại</p>
            @if (lstTraLai.Count() == 0)
            {
                <div class="h-100" id="wrapper" style="background-color: white; padding: 50px 0;">
                    <center class="mt-3">
                        <img style="width:13%" src="https://cdn-icons-png.flaticon.com/512/1376/1376786.png" />
                        <br />
                        <br />
                        <p>Không có đơn hàng nào!</p>
                        <a class="btn btn-outline-primary mb-1 mt-2" href="@Url.Action("ShowAllProducts","Product")" style="font-weight:bold"> VỀ TRANG CHỦ </a>
                        <p>Khi cần trợ giúp vui lòng liên hệ <a href="tel:0397495029" style="text-decoration-color:#1899ba">&nbsp;0397.495.029</a>&nbsp;(7h30 - 22h)</p>
                    </center>

                </div>
            }
            else
            {
                <div class="">
                    @foreach (var or in lstTraLai)
                    {

                        var det = mydb.DetailsOrders.Where(n => n.orderID == or.orderID).FirstOrDefault();
                        int tt = (int)det.orderQuantity * (int)det.proPrice;
                        ttDHDH = ttDHDH + (int)det.orderQuantity * (int)det.proPrice;
                        var lstDetOrder = mydb.DetailsOrders.Where(n => n.orderID == or.orderID);
                        var orcan = mydb.returnProducts.Where(n => n.id_order == or.orderID).FirstOrDefault();
                        <div class="SP_order">
                            <div class="d-flex SP_order_header row">
                                <div class="d-flex SP_order_header_ma col-2">
                                    <h5 style="margin-right:7px">Mã đơn hàng:</h5>
                                    <h5>@or.orderID</h5>
                                </div>
                                <div class="col-4" style=" margin: 7px;">Ngày mua: @or.orderDate</div>
                                <div class="col-5" style="text-align: end;">
                                    <a class="btn AdOrcer_btn" href="@Url.Action("completeOrder", "Payment", new { idOr = or.orderID, strURL = Request.Url.ToString() })" style="text-decoration:none;color:black">Giao hàng thành công</a>
                                </div>
                            </div>
                            <div>
                                @foreach (var item in lstDetOrder)
                                {
                                    mydb = new QL_LaptopEntities();
                                    var cus = mydb.Customers.Where(n => n.cusID == item.cusID).FirstOrDefault();
                                    var cusAdr = mydb.CustomerAddresses.Where(n => n.cusID == cus.cusID).FirstOrDefault();
                                    var pro = mydb.Products.Where(n => n.id == item.proID).FirstOrDefault();
                                    var orr = mydb.Orders.Where(n => n.cusID == cus.cusID).FirstOrDefault();

                                    using (Html.BeginForm("Update", "Cart"))
                                    {
                                        <div class="row SP_order_main">
                                            <div class="col-2">
                                                <img src="~/Assets/Image/ImageProduct/@pro.avatar" alt="" class="img-fluid d-none d-md-block rounded mb-2 shadow ">
                                            </div>
                                            <div class="col-8">
                                                <p class="SP_order_name">@pro.Name</p>
                                                <p class="SP_order_quantity">Số lượng: @item.orderQuantity</p>
                                            </div>
                                            <div class="col-2">
                                                <p class="SP_order_price">@String.Format("{0:0,0}", @pro.price) VND</p>
                                            </div>
                                        </div>

                                    }
                                }

                            </div>
                            <div class="d-flex reason">
                                <p style="font-weight: 600; margin-right: 10px">Trạng thái:</p>
                                <p>@orcan.tt</p>
                            </div>
                            <div class="SP_order_totalMoney">
                                <img style="width:25px;height:25px" src="https://cdn-icons-png.flaticon.com/512/543/543135.png" />
                                <p style="padding:0 10px">Thành tiền: </p>
                                <p style=" font-size: 22px; padding: 0 10px; color: #ee4d2d;">@String.Format("{0:0,0}", @tt) VND</p>

                            </div>
                        </div>

                    }
                </div>
                <div class="row mt-4 d-flex align-items-center" style="margin-left:20px;margin-bottom:20px">

                    <div class="col-sm-6 mb-3 mb-m-1 order-md-1 text-md-left">
                        <a href="@Url.Action("ShowAllProducts","Product")">
                            <i class="fas fa-arrow-left mr-2"></i> Tiếp tục mua sắm
                        </a>
                    </div>
                </div>
            }

        </div>
    </div>
</div>
<script>
    function click() {
        location.reload();
    }
    function kt(i) {
        if (i == 2) {
            Swal.fire({
                title: 'Tìm kiếm thành công!',
                showClass: {
                    popup: 'animate__animated animate__fadeInDown'
                },
                hideClass: {
                    popup: 'animate__animated animate__fadeOutUp'
                }
            })
        }
        else
            if (i == 1) {
                Swal.fire({
                    title: 'Số điện thoại không có đơn hàng!',
                    showClass: {
                        popup: 'animate__animated animate__fadeInDown'
                    },
                    hideClass: {
                        popup: 'animate__animated animate__fadeOutUp'
                    }
                })
            }

    }
</script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

